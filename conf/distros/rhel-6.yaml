---
# RedHat Enterprise Linux 6
name: rhel-6
distro_pattern: redhat-6(.*)
packager_name: anvil.packaging.yum:YumPackager
commands:
    apache:
        restart: service httpd restart
        settings:
            conf-link-target: /etc/httpd/conf.d/wsgi-horizon-000-default.conf
        start: service httpd start
        status: service httpd status
        stop: service httpd stop
    git:
        checkout: git checkout
        clone: git clone
    libvirt:
        restart: service libvirtd restart
        status: service libvirtd status
        # This is just used to check that libvirt will work with a given protocol
        verify: virsh -c %VIRT_PROTOCOL% uri
    mysql:
        # NOTE: we aren't stopping any sql injection...
        create_db: mysql --user=%USER% --password=%PASSWORD% -e 
          "CREATE DATABASE %DB%;"
        create_db_utf8: mysql --user=%USER% --password=%PASSWORD% -e 
          "CREATE DATABASE %DB% CHARACTER SET utf8;"
        drop_db: mysql --user=%USER% --password=%PASSWORD% -e 
          "DROP DATABASE IF EXISTS %DB%;"
        grant_all: mysql --user=%USER% --password=%PASSWORD% -e 
          "GRANT ALL PRIVILEGES ON *.* TO '%USER%'@'%' IDENTIFIED BY '%PASSWORD%'; 
           FLUSH PRIVILEGES;"
        restart: service mysqld restart
        set_pwd: mysql --user=%USER% --password=%OLD_PASSWORD% -e 
          "USE mysql; 
           UPDATE user SET password=PASSWORD('%NEW_PASSWORD%') WHERE User='%USER%';
           FLUSH PRIVILEGES;"
        start: service mysqld start
        status: service mysqld status
        stop: service mysqld stop
    pip: pip-python
    # Used to know where to find nova root wrap
    bin_dir: "/usr/bin"
    sudoers_dir: "/etc/sudoers.d/"
    # Commands used when setting up python projects
    python:
        setup: python setup.py develop
        unsetup: python setup.py develop --uninstall
    # Where component symlinks will go, the component name will become a directory
    # under this directory where its configuration files will be connected to there
    # actual location.
    base_link_dir: "/etc/"
    rabbit-mq:
        change_password: rabbitmqctl change_password
        restart: service rabbitmq-server restart
        start: service rabbitmq-server start
        status: service rabbitmq-server status
        stop: service rabbitmq-server stop                 
components:
    cinder:
        action_classes:
            install: anvil.components.cinder:CinderInstaller
            running: anvil.components.cinder:CinderRuntime
            uninstall: anvil.components.cinder:CinderUninstaller
        pip_to_package:
        -   name: MySQL-python
            package:
                name: MySQL-python
    db:
        action_classes:
            install: anvil.distros.rhel6:DBInstaller
            running: anvil.components.db:DBRuntime
            uninstall: anvil.components.db:DBUninstaller
        packages:
        -   name: mysql
        -   name: mysql-server
    general:
        action_classes:
            install: anvil.components.pkglist:Installer
            running: anvil.component:EmptyRuntime
            uninstall: anvil.components.pkglist:Uninstaller
        packages:
        # Shared system packages
        -   name: coreutils
        -   name: curl
        -   name: euca2ools
        -   name: gawk
        -   name: git
        -   name: iputils
        -   name: libxml2-devel
        -   name: libxslt-devel
        -   name: lsof
        -   name: mlocate
        -   name: openssh-server
        -   name: psmisc
        -   name: screen
        -   name: sudo
        -   name: tcpdump
        -   name: unzip
        -   name: wget
        # Shared python packages
        -   name: python
        -   name: python-devel
        -   name: python-distutils-extra
        -   name: python-setuptools
        pip_to_package:
        # Shared pypi packages + there package information.
        # Packages is what is really used for installation (the pypi name
        # is just for matching since the general section is not python code).
        -   name: pylint 
            package:
                name: pylint
        -   name: anyjson
            package:
                name: python-anyjson
        -   name: argparse 
            package:
                name: python-argparse
        -   name: babel
            package:
                name: python-babel
        -   name: eventlet
            package:
                name: python-eventlet
        -   name: greenlet
            package:
                name: python-greenlet
        -   name: httplib2
            package:
                name: python-httplib2
        -   name: iso8601
            package:
                name: python-iso8601
        -   name: lxml
            package:
                name: python-lxml
        -   name: mock
            package:
                name: python-mock
        -   name: mox
            package:
                name: python-mox
        -   name: nose
            package:
                name: python-nose1.1
        -   name: paste
            package:
                name: python-paste
        -   name: pastedeploy
            package:
                name: python-paste-deploy1.5
        -   name: pep8
            package:
                name: python-pep8
        -   name: pip
            package:
                name: python-pip
        -   name: routes
            package:
                name: python-routes1.12
        -   name: simplejson
            package:
                name: python-simplejson
        -   name: sqlalchemy
            package:
                name: python-sqlalchemy0.7
        -   name: unittest2
            package:
                name: python-unittest2
        -   name: virtualenv
            package:
                name: python-virtualenv
        -   name: webob
            package:
                name: python-webob1.0
        pips:
        # Pips that aren't packages yet (or versions aren't right...)
        -   name: coverage
        -   name: nose-exclude
        -   name: openstack.nose_plugin
        -   name: passlib
        -   name: prettytable
            version: "0.6" # This is not right, 0.6 and 0.6.1 are needed??
        -   name: pycrypto
            options: --upgrade
        -   name: requests
        -   name: sphinx
        -   name: sqlalchemy-migrate
        -   name: distribute
    glance:
        action_classes:
            install: anvil.components.glance:GlanceInstaller
            running: anvil.components.glance:GlanceRuntime
            uninstall: anvil.components.glance:GlanceUninstaller
        # When parsing 'tools/pip-requires' and 
        # 'tools/test-requires' (if they exist)
        # the following map will be used to translate names
        # and versions inside those files into distribution
        # package names equivalents (if possible)
        pip_to_package:
        -   name: pysendfile
            package:
                name: pysendfile
        -   name: kombu
            package:
                # Only needed for notifications???
                name: python-kombu
        packages:
        -   name: MySQL-python
        pips:
        # Pips that aren't packages yet (and not in the 'general' section)
        -   name: boto
            version: "2.1.1"
        -   name: wsgiref
        -   name: xattr
        -   name: jsonschema
    glance-client:
        action_classes:
            install: anvil.components.glance_client:GlanceClientInstaller
            running: anvil.components.glance_client:GlanceClientRuntime
            uninstall: anvil.components.glance_client:GlanceClientUninstaller
        pips:
        -   name: nosexcover
        -   name: setuptools-git
        -   name: warlock
            version: "0.1.0"
    horizon:
        action_classes:
            install: anvil.distros.rhel6:HorizonInstaller
            running: anvil.components.horizon:HorizonRuntime
            uninstall: anvil.components.horizon:HorizonUninstaller
        packages:
        -   name: nodejs-compat-symlinks
            source-rpm: http://nodejs.tchol.org/repocfg/el/nodejs-stable-release.noarch.rpm
        -   name: npm
            source-rpm: http://nodejs.tchol.org/repocfg/el/nodejs-stable-release.noarch.rpm
        -   name: httpd
        -   name: mod_wsgi
    keystone:
        action_classes:
            install: anvil.components.keystone:KeystoneInstaller
            running: anvil.components.keystone:KeystoneRuntime
            uninstall: anvil.components.keystone:KeystoneUninstaller
        packages:
        -   name: MySQL-python
        pip_to_package:
        -   name: netifaces
            package:
                name: python-netifaces
        pips:
        -   name: pam
            version: '0.1.4'
        -   name: nosexcover
        -   name: webtest  # This version in package form conflicts with webob1.0
    keystone-client:
        action_classes:
            install: anvil.components.keystone_client:KeyStoneClientInstaller
            running: anvil.components.keystone_client:KeyStoneClientRuntime
            uninstall: anvil.components.keystone_client:KeyStoneClientUninstaller
    nova:
        action_classes:
            install: anvil.distros.rhel6:NovaInstaller
            running: anvil.components.nova:NovaRuntime
            uninstall: anvil.components.nova:NovaUninstaller
        packages:
        -   name: MySQL-python
        -   name: dnsmasq
        -   name: ebtables
        -   name: fuse
        -   name: iptables
        -   name: iputils
        -   name: kpartx
        -   name: parted
        -   name: sqlite
        -   name: vconfig
        pip_to_package:
        -   name: amqplib
            package:
                name: python-amqplib
        -   name: netaddr
            package:
                name: python-netaddr
        -   name: suds
            package: 
                name: python-suds
        -   name: paramiko
            package:
                name: python-paramiko
        -   name: feedparser
            package:
                name: python-feedparser
        -   name: lockfile
            package:
                name: python-lockfile
        pips:
        -   name: Cheetah
            version: "2.4.4"
        -   name: python-daemon
            version: "1.5.5"
        subsystems:
            no-vnc:
                packages:
                -   name: novnc
            cpu:
                packages:
                -   name: iscsi-initiator-utils
                -   name: libguestfs
                -   name: libguestfs-mount
                -   name: libguestfs-tools
                -   name: libvirt
                -   name: libvirt-client
                -   name: libvirt-python
                -   name: lvm2
                -   name: qemu-img
                -   name: qemu-kvm
            vol:
                packages:
                -   name: iscsi-initiator-utils
                -   name: lvm2
                -   name: scsi-target-utils
    nova-client:
        action_classes:
            install: anvil.components.nova_client:NovaClientInstaller
            running: anvil.components.nova_client:NovaClientRuntime
            uninstall: anvil.components.nova_client:NovaClientUninstaller
    openstack-client:
        action_classes:
            install: anvil.components.openstack_client:OpenStackClientInstaller
            running: anvil.components.openstack_client:OpenStackClientRuntime
            uninstall: anvil.components.openstack_client:OpenStackClientUninstaller
        pips:
        -   name: cliff
    quantum:
        action_classes:
            install: anvil.components.quantum:QuantumInstaller
            running: anvil.components.quantum:QuantumRuntime
            uninstall: anvil.components.quantum:QuantumUninstaller
    quantum-client:
        action_classes:
            install: anvil.components.quantum_client:QuantumClientInstaller
            running: anvil.components.quantum_client:QuantumClientRuntime
            uninstall: anvil.components.quantum_client:QuantumClientUninstaller
    rabbit-mq:
        action_classes:
            install: anvil.components.rabbit:RabbitInstaller
            running: anvil.distros.rhel6:RabbitRuntime
            uninstall: anvil.components.rabbit:RabbitUninstaller
        packages:
        -   name: rabbitmq-server
            pre-install:
            -   cmd:
                - service
                - qpidd
                - stop
                ignore_failure: true
                run_as_root: true
            -   cmd:
                - chkconfig
                - qpidd
                - 'off'
                ignore_failure: true
                run_as_root: true
...

